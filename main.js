(()=>{"use strict";var e={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-42",headers:{authorization:"ed00eefe-4c09-4ee0-93c8-16744cef6ae5","Content-Type":"application/json"}};function t(t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r={method:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",headers:e.headers};return n&&(r.body=JSON.stringify(n)),fetch("".concat(e.baseUrl).concat(t),r).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function n(){return t("/users/me")}function r(e){var t=document.querySelector(".profile__title"),n=document.querySelector(".profile__description"),r=document.querySelector(".profile__image");t.textContent=e.name,n.textContent=e.about,r.style.backgroundImage="url('".concat(e.avatar,"')")}function o(e,t,n,r,o){var i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),c=i.querySelector(".card__image"),a=i.querySelector(".card__title"),u=i.querySelector(".card__delete-button"),l=i.querySelector(".card__like-button"),s=i.querySelector(".card__like-count");c.src=e.link,c.alt=e.name,a.textContent=e.name,s.textContent=e.likes.length,e.likes.some((function(e){return e._id===o}))&&l.classList.add("card__like-button_is-active"),c.addEventListener("click",(function(){r(e)})),e.owner._id!==o?u.style.display="none":u.addEventListener("click",(function(n){n.stopPropagation(),t(i,e._id)}));var d=function(e){s.textContent=e};return l.addEventListener("click",(function(t){t.stopPropagation();var r=l.classList.contains("card__like-button_is-active");n(l,e._id,r,d,o)})),i}function i(e,n){(function(e){return t("/cards/".concat(e),"DELETE")})(n).then((function(){e.remove()})).catch((function(e){console.error("Ошибка при удалении карточки:",e)}))}function c(e,n,r,o,i){var c=parseInt(e.closest(".card").querySelector(".card__like-count").textContent);o(r?c-1:c+1),e.classList.toggle("card__like-button_is-active");var a=r?function(e){return t("/cards/".concat(e,"/likes"),"DELETE")}(n):function(e){return t("/cards/".concat(e,"/likes"),"PUT")}(n);a.then((function(t){if(!t||!t.likes)throw new Error("Invalid server response");o(t.likes.length),t.likes.some((function(e){return e._id===i}))!==!r&&e.classList.toggle("card__like-button_is-active")})).catch((function(t){console.error("Ошибка при обновлении лайка:",t),o(c),e.classList.toggle("card__like-button_is-active")}))}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",l)}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",l)}function l(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&(u(t),document.removeEventListener("keydown",l))}}function s(e,t,n){var r=n.inputErrorClass,o=n.errorClass;e.classList.remove(r),t&&(t.textContent="",t.classList.remove(o))}function d(e,t,n){var r=Array.from(e).every((function(e){return e.validity.valid}));t&&(t.disabled=!r,t.classList.toggle(n,!r))}function p(e,t){var n=e.querySelectorAll(t.inputSelector),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){s(n,e.querySelector("#".concat(n.id,"-error")),t),n.setCustomValidity("")})),r&&(r.disabled=!0,r.classList.add(t.inactiveButtonClass))}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var _=document.querySelector(".places__list"),f=document.querySelector(".profile__edit-button"),m=document.querySelector(".profile__add-button"),y=document.querySelector(".popup_type_edit"),L=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_image"),S=document.querySelector('.popup__form[name="edit-profile"]'),h=document.querySelector(".popup__input_type_name"),C=document.querySelector(".popup__input_type_description"),q=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),g=document.querySelector('.popup__form[name="new-place"]'),x=document.querySelector(".popup__input_type_card-name"),k=document.querySelector(".popup__input_type_url"),A=b.querySelector(".popup__image"),w=b.querySelector(".popup__caption"),T=document.querySelector(".popup_type_edit-avatar"),D=document.querySelector('.popup__form[name="edit-avatar"]'),P=document.querySelector(".popup__input_type_avatar-url"),U=document.querySelector("#error-avatar-url"),I=D.querySelector(".popup__button"),j=document.querySelector(".profile__image"),B=I.textContent;function M(e){A.src=e.link,A.alt=e.name,w.textContent=e.name,a(b)}S.addEventListener("submit",(function(e){e.preventDefault();var n=h.value,o=C.value,i=S.querySelector(".popup__button"),c=i.textContent;i.textContent="Сохранение...",function(e,n){return t("/users/me","PATCH",{name:e,about:n})}(n,o).then((function(e){r(e),u(y)})).catch((function(e){console.error("Ошибка при обновлении профиля:",e)})).finally((function(){i.textContent=c}))})),g.addEventListener("submit",(function(e){e.preventDefault();var n=x.value,r=k.value,a=g.querySelector(".popup__button"),l=a.textContent;a.textContent="Создание...",a.disabled=!0,function(e,n){return t("/cards","POST",{name:e,link:n})}(n,r).then((function(e){var t=o(e,i,c,M,e.owner._id);_.prepend(t),u(L),g.reset()})).catch((function(e){console.error("Ошибка при создании карточки:",e)})).finally((function(){a.textContent=l,a.disabled=!1}))})),f.addEventListener("click",(function(){h.value=q.textContent,C.value=E.textContent,p(S,O),a(y)})),m.addEventListener("click",(function(){p(g,O),a(L)})),document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(e){u(e.target.closest(".popup"))}))})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&u(e)}))}));var O={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",avatarFormSelector:'.popup__form[name="edit-avatar"]',avatarInputSelector:".popup__input_type_avatar-url"};!function(e){document.querySelectorAll(e.formSelector).forEach((function(t){t.setAttribute("novalidate",!0),function(e,t){var n=e.querySelectorAll(t.inputSelector),r=e.querySelector(t.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){var r=e.querySelector("#".concat(t.id,"-error"));r&&(t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage||"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"):t.setCustomValidity(""),t.validity.valid?s(t,r,n):function(e,t,n){var r=n.inputErrorClass,o=n.errorClass;e.classList.add(r),t&&(t.textContent=e.validationMessage,t.classList.add(o))}(t,r,n),r.textContent=t.validationMessage)}(e,o,t),d(n,r,t.inactiveButtonClass)}))})),e.addEventListener("submit",(function(e){return e.preventDefault()})),d(n,r,t.inactiveButtonClass)}(t,e)}))}(O);var R=document.querySelector("#errorName"),V=document.querySelector("#errorDescription"),H=document.querySelector(".popup__button"),N=/^[a-zA-Zа-яА-ЯёЁ\- ]+$/;function z(){var e=h.value.trim();return R.textContent="",R.classList.remove("visible"),h.classList.remove("invalid"),""===e?(F(R,"Вы пропустили это поле"),!1):e.length<2||e.length>40?(F(R,"Длина должна быть от 2 до 40 символов"),!1):!!N.test(e)||(F(R,"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"),!1)}function $(){var e=C.value.trim();return V.textContent="",V.classList.remove("visible"),C.classList.remove("invalid"),""===e?(F(V,"Поле обязательно для заполнения"),!1):e.length<2||e.length>200?(F(V,"Должно быть от 2 до 200 символов"),!1):!!N.test(e)||(F(V,"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"),!1)}function F(e,t){return e.textContent=t,e.classList.add("visible"),e.previousElementSibling.classList.add("invalid"),!1}function G(){var e=z(),t=$();return H.disabled=!(e&&t),e&&t}h.addEventListener("input",(function(){z(),G()})),C.addEventListener("input",(function(){$(),G()})),h.addEventListener("blur",z),C.addEventListener("blur",$),S.addEventListener("submit",(function(e){e.preventDefault(),G()&&console.log("Форма валидна, можно сохранять")})),document.querySelector(".popup_type_edit .popup__close").addEventListener("click",(function(){R.textContent="",R.classList.remove("visible"),h.classList.remove("invalid"),V.textContent="",V.classList.remove("visible"),C.classList.remove("invalid"),R&&(R.textContent="",R.classList.remove("visible")),V&&(V.textContent="",V.classList.remove("visible")),h&&(h.classList.remove("invalid"),h.value=q.textContent),C&&(C.classList.remove("invalid"),C.value=E.textContent),G()}));var J=document.querySelector("#errorPlace"),Z=document.querySelector("#errorUrl"),K=g.querySelector(".popup__button");function Q(){var e=x.value.trim();return J.textContent="",J.classList.remove("visible"),x.classList.remove("invalid"),""===e?(F(J,"Вы пропустили это поле"),!1):e.length<2||e.length>30?(F(J,"Длина должна быть от 2 до 30 символов"),!1):!!N.test(e)||(F(J,"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"),!1)}function W(){var e=k.value.trim();return Z.textContent="",Z.classList.remove("visible"),k.classList.remove("invalid"),""===e?(F(Z,"Вы пропустили это поле"),!1):!!k.checkValidity()||(F(Z,"Введите корректный URL"),!1)}function X(){var e=Q(),t=W();return K.disabled=!(e&&t),e&&t}function Y(){D.reset(),U.textContent="",U.classList.remove("popup__error_visible"),P.classList.remove("popup__input_type_error"),I.disabled=!0,I.textContent=B}function ee(){var e=P.value.trim();if(U.textContent="",U.classList.remove("popup__error_visible"),P.classList.remove("popup__input_type_error"),""===e)return F(U,"Вы пропустили это поле"),!1;try{var t=new URL(e);return!!["http:","https:"].includes(t.protocol)||(F(U,"URL должен начинаться с http:// или https://"),!1)}catch(e){return F(U,"Введите корректный URL"),!1}}function te(){var e=ee();return I.disabled=!e,e}x.addEventListener("input",(function(){Q(),X()})),k.addEventListener("input",(function(){W(),X()})),x.addEventListener("blur",Q),k.addEventListener("blur",W),m.addEventListener("click",(function(){a(L),J&&(J.textContent="",J.classList.remove("visible")),x&&x.classList.remove("invalid"),Z&&(Z.textContent="",Z.classList.remove("visible")),k&&k.classList.remove("invalid"),g.reset(),K&&(K.disabled=!0)})),document.addEventListener("DOMContentLoaded",(function(){n().then((function(e){r(e)})).catch((function(e){console.error("Ошибка при загрузке данных пользователя:",e)}))})),Promise.all([n(),t("/cards")]).then((function(e){var t,n,a=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,c,a=[],u=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return a}}(t,n)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=a[0],l=a[1];r(u),function(e,t){_.innerHTML="",e.forEach((function(e){var n=o(e,i,c,M,t);_.append(n)}))}(l,u._id)})).catch((function(e){console.error("Ошибка при загрузке данных:",e)})),j.addEventListener("click",(function(){Y(),a(T)})),P.addEventListener("input",te),P.addEventListener("blur",ee),D.addEventListener("submit",(function(e){if(e.preventDefault(),te()){var n,r=I.textContent;I.textContent="Сохранение...",I.disabled=!0,(n=P.value.trim(),t("/users/me/avatar","PATCH",{avatar:n})).then((function(e){j.style.backgroundImage="url('".concat(e.avatar,"')"),u(T),Y()})).catch((function(e){console.error("Ошибка при обновлении аватара:",e),F(U,"Ошибка при обновлении аватара"),I.textContent=r})).finally((function(){I.disabled=!1}))}}))})();